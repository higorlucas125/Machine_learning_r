```{r}
here::i_am("trabalhoMineracao/classificacao.Rmd")
library(here)
library(tidyverse)
library(janitor)
library(lubridate)


tabela_despesa_publica2 <- read_csv2("despesasFormatado.csv")
tabela_backup <- tabela_despesa_publica2
tabela_despesa_publica2$`Valor Recebido`[tabela_despesa_publica2$`Valor Recebido` == 0] <- 1
tabela_despesa_publica2$`Valor Recebido`[tabela_despesa_publica2$`Valor Recebido` > 779361627] <- 1000000
```

Utilizando o Rpart para prever o valor das Receitas

```{r}
length(tabela_despesa_publica2$`Tipo de Favorecido`)

tabela_despesa_publica2$cnpj_cpf <- as.factor(tabela_despesa_publica2$cnpj_cpf)
tabela_despesa_publica2$nome <- as.factor(tabela_despesa_publica2$nome)
tabela_despesa_publica2$`Tipo de Favorecido` <- as.factor(tabela_despesa_publica2$`Tipo de Favorecido`)
linhas <- sample(1:length(tabela_despesa_publica2$`Tipo de Favorecido`),length(tabela_despesa_publica2$`Tipo de Favorecido`)*0.7)
```

70%
```{r}
treino <- tabela_despesa_publica2[linhas,]
```
30%
```{r}
teste <- tabela_despesa_publica2[-linhas,]

length(teste$`Tipo de Favorecido`) + length(treino$`Tipo de Favorecido`)
```

Criar o modelo
```{r}
library(rpart)
modelo <- rpart(`Valor Recebido` ~., data=treino, control=rpart.control(cp=0))
```

Realizar previsoes

predict
```{r}
teste$Previsao <- predict(modelo,teste)
View(teste)
teste$cnpj_cpf <- NULL

```

Analisar resultados
```{r}
teste$Pre <- round(teste$Previsao/teste$`Valor Recebido`,2)
teste$Pre <- teste$P-1
teste$Pre <- abs(teste$Pre)
R_1 <- summary(teste$Pre)
R_1
```

Organizar os dados em quantidade
```{r}
summary(tabela_despesa_publica2$`Valor Recebido`)
menos_de_dez_porcento <- quantile(tabela_despesa_publica2$`Valor Recebido`,0.90)

hist(tabela_despesa_publica2$`Valor Recebido`[tabela_despesa_publica2$`Valor Recebido`< menos_de_dez_porcento],xlab="Valores menores que 10%",breaks=10,labels=T)

```

Media de valores summary
```{r}
tabela_despesa_publica2$`Valor Recebido` %>% mean
summary(tabela_despesa_publica2$`Valor Recebido`)
```
